/*!
 * Jusfoun D3 Chart Library
 * Powered by Jusfoun Visualization Department
 * Contact:
 *   vd@jusfoun.com
 *   http://vd.jusfoun.com
 *
 * Copyright (c) 2016, Jusfoun Big Data Group Inc.
 * All rights reserved.
 *
 * LICENSE
 * http://www.jusfoun.com/software/LICENSE.txt
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define("JusfounD3Charts",["d3"],e):"object"==typeof exports?exports.JusfounD3Charts=e(require("d3")):t.JusfounD3Charts=e(t.d3)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){e.PolarBranchChart=i(1),e.GraphUtil=i(7),e.dragZoomRotateControl=i(10),e.SvgUtil=i(9)},function(t,e,i){var n=i(2),a=i(3),r=i(7),s=i(9),o=i(8),l=i(10),h=Math.PI/180,d=1/h,u=function(){a.call(this);var t=this;this._domElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._d3Svg=o.select(this._domElement),this._d3G=this._d3Svg.append("g"),this._d3Tree=o.tree(),this._position={x:0,y:0},this._polarProject=this._polarProject.bind(this),this._placeDiagonal=this._placeDiagonal.bind(this),this._d3Control=l(this._d3Svg).scaleExtent([.25,8]).duration(0).on("zoom",function(){t.rotation(o.event.rotation),t._d3G.attr("transform",o.event.transform)})};u.prototype=n(a.prototype,{constructor:u,_d3Svg:void 0,_d3G:void 0,_d3Tree:void 0,_d3Control:void 0,_d3Vertices:void 0,_d3Edges:void 0,_d3Labels:void 0,_invalidateDataFlag:!1,_invalidateData:function(){this._invalidateDataFlag||(this._invalidateDataFlag=!0,this.invalidateProperties())},_invalidateStyleFlag:!1,_invalidateStyle:function(){this._invalidateStyleFlag||(this._invalidateStyleFlag=!0,this.invalidateProperties())},_invalidatePositionFlag:!1,_invalidatePosition:function(){this._invalidatePositionFlag||(this._invalidatePositionFlag=!0,this.invalidateProperties())},_invalidateRotationFlag:!1,_invalidateRotation:function(){this._invalidateRotationFlag||(this._invalidateRotationFlag=!0,this.invalidateProperties())},_vertexData:void 0,vertexData:function(t){return 0==arguments.length?this._vertexData:(this._vertexData=t,void this._invalidateData())},_edgeData:void 0,edgeData:function(t){return 0==arguments.length?this._edgeData:(this._edgeData=t,this._treeData=void 0,void this._invalidateData())},_treeData:void 0,treeData:function(t){return 0==arguments.length?this._treeData:(this._treeData=t,void this._invalidateData())},_palette:["#000000","#444444","#888888","#CCCCCC"],palette:function(t){return 0==arguments.length?this._palette:(this._palette=t,void this._invalidateStyle())},_domElement:void 0,domElement:function(){return this._domElement},_position:void 0,position:function(t){return 0==arguments.length?this._position:(this._position=t,void this._invalidatePosition())},_rotation:0,rotation:function(t){return 0==arguments.length?this._rotation:(this._rotation=t,void this._invalidateRotation())},_radius:void 0,radius:function(t){return 0==arguments.length?this._radius:(this._radius=t,void this._invalidateData())},_polarProject:function(t,e){var i=this._rotation||0,n=(t-90)*h+i,a=e;return[a*Math.cos(n),a*Math.sin(n)]},_placeDiagonal:function(t,e,i,n){var a=this._polarProject;return"M"+a(t,e)+"C"+a(t,(e+n)/2)+" "+a(i,(e+n)/2)+" "+a(i,n)},commitProperties:function(){var t=this,e=800,i=isNaN(this._radius)?Math.min(this._width,this._height):2*this._radius,n=4*i/e,a=12*i/e,s=4.96*i/e,l=6*i/e,h=this._polarProject,u=this._placeDiagonal;if(this._treeData||this._edgeData){if(this._invalidateDataFlag){!this._treeData&&this._edgeData&&(this._treeData=r.toTreeData(this._edgeData,this._vertexData)),this._d3Tree.size([360,i/2]),this._d3Tree.separation(function(t,e){return(t.parent==e.parent?1:2)/t.depth});var v=this._d3Tree(o.hierarchy(this._treeData,function(t){return t.children})).sort(function(t,e){return t.height-e.height}),_=v.descendants(),p=v.links();this._d3Edges=this._d3G.selectAll(".edge").data(p).enter().append("path").attr("class","edge").style("opacity",0).style("fill","none").style("stroke",function(e){return t._palette[e.source.depth%t._palette.length]}),this._d3Vertices=this._d3G.selectAll(".vertex").data(_).enter().append("g").attr("class","vertex").style("opacity",0).style("cursor","pointer").on("mouseout",function(e){var i=o.select(this);i.select("circle").style("stroke",t._palette[e.depth%t._palette.length]).style("fill","#FFFFFF"),i.select("text").style("fill","#555555"),t.dispatchEvent({type:"vertexItemMouseOut",event:o.event})}).on("mouseover",function(e){var i=o.select(this);i.select("circle").style("stroke","#000000").style("fill","#FF0000"),i.select("text").style("fill","#FF0000"),t.dispatchEvent({type:"vertexItemMouseOver",mouseEvent:o.event,data:e.data})}).on("click",function(e){t.dispatchEvent({type:"vertexItemClick",mouseEvent:o.event,data:e.data})}),this._d3Vertices.append("circle").style("stroke",function(e){return t._palette[e.depth%t._palette.length]}).style("fill",function(t){return"#FFFFFF"}).attr("r",n),this._d3Labels=this._d3Vertices.append("text").attr("dy",s+"px").style("fill","#555555").style("opacity",0).style("font-size",a+"px").text(function(t){return t.data.name}),this._d3Vertices.transition().duration(1e3).tween("vertex.appear",function(t){var e=this;return function(i){e.setAttribute("transform","translate("+h(t.x*i,t.y*i)+")"),e.style.opacity=i}}),this._d3Edges.transition().duration(1e3).tween("edge.appear",function(t){var e=this;return function(i){var n=t.source,a=t.target;e.setAttribute("d",u(n.x*i,n.y*i,a.x*i,a.y*i)),e.style.opacity=i}}),this._d3Labels.transition().delay(1e3).duration(500).tween("label.appear",function(t){var e=this;return function(t){e.style.opacity=t}}),this._position.x=this._width/2,this._position.y=this._height/2,this._invalidatePositionFlag=!0,this._invalidateStyleFlag=!0,this._invalidateRotationFlag=!0,this._invalidateDataFlag=!1}this._invalidatePositionFlag&&(this._d3Control.translate(this._d3Svg,this._position.x,this._position.y),this._invalidatePositionFlag=!1),this._invalidateRotationFlag&&(this._d3Edges.attr("d",function(t){return u(t.source.x,t.source.y,t.target.x,t.target.y)}),this._d3Vertices.attr("transform",function(t){return"translate("+h(t.x,t.y)+")"}),this._d3Labels.attr("x",function(e){var i=(e.x+t._rotation*d)%360;return i<0&&(i+=360),i<180==!e.children?l:-l}).style("text-anchor",function(e){var i=(e.x+t._rotation*d)%360;return i<0&&(i+=360),i<180==!e.children?"start":"end"}).attr("transform",function(e){var i=(e.x+t._rotation*d)%360;return i<0&&(i+=360),"rotate("+(i<180?i-90:i+90)+")"}),this._invalidateRotationFlag=!1),this._invalidateStyleFlag&&(this._invalidateStyleFlag=!1,this._d3Vertices.selectAll("text").style("font-family","微软雅黑"))}},updateDisplayList:function(){this._d3Svg.attr("width",this._width).attr("height",this._height)},capture:function(t,e){s.toDataUrl(this.domElement(),t,e)}}),t.exports=u},function(t,e){function i(){if(arguments.length<1)return null;for(var t=Object.create(arguments[0]),e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t}t.exports=i},function(t,e,i){function n(){r.call(this)}var a=i(2),r=i(4),s=i(5);n.prototype=a(r.prototype,{constructor:n,_invalidatePropertiesFlag:!1,_invalidateSizeFlag:!1,_invalidateDisplayListFlag:!1,_x:0,x:function(t){return 0==arguments.length?this._x:void(this._x!=t&&(this._x=t,this.invalidateProperties(),this.invalidateSize(),this.invalidateDisplayList()))},_y:0,y:function(t){return 0==arguments.length?this._y:void(this._y!=t&&(this._y=t,this.invalidateProperties(),this.invalidateSize(),this.invalidateDisplayList()))},_width:100,width:function(t){return 0==arguments.length?this._width:void(this._width!=t&&(this._width=t,this.invalidateProperties(),this.invalidateSize(),this.invalidateDisplayList()))},_height:100,height:function(t){return 0==arguments.length?this._height:void(this._height!=t&&(this._height=t,this.invalidateProperties(),this.invalidateSize(),this.invalidateDisplayList()))},initialize:function(){},invalidateProperties:function(){this._invalidatePropertiesFlag||(this._invalidatePropertiesFlag=!0,s.getInstance().invalidateProperties(this))},invalidateSize:function(){this._invalidateSizeFlag||(this._invalidateSizeFlag=!0,s.getInstance().invalidateSize(this))},invalidateDisplayList:function(){this._invalidateDisplayListFlag||(this._invalidateDisplayListFlag=!0,s.getInstance().invalidateDisplayList(this))},validateNow:function(){s.getInstance().validateClient(this)},validateProperties:function(){this._invalidatePropertiesFlag&&(this.commitProperties(),this._invalidatePropertiesFlag=!1)},validateSize:function(){this._invalidateSizeFlag&&(this.measure(),this._invalidateSizeFlag=!1)},validateDisplayList:function(){this._invalidateDisplayListFlag&&(this.updateDisplayList(),this._invalidateDisplayListFlag=!1)},commitProperties:function(){},measure:function(){},updateDisplayList:function(){},setStyle:function(){}}),t.exports=n},function(t,e){function i(t){if(t&&!(t instanceof i))throw new Error("Illegal target.");this._target=t}i.prototype={constructor:i,_target:null,addEventListener:function(t,e,i){var n=this;if(!t||"function"!=typeof e)throw new Error("Illegal parameters.");void 0===n._mapKTypeVListenerTokens&&(n._mapKTypeVListenerTokens={});var a=n._mapKTypeVListenerTokens[t];void 0===a&&(a=[],n._mapKTypeVListenerTokens[t]=a);var r={listener:e,thisArg:i};a.push(r)},removeEventListener:function(t,e){var i=this;if(!t||"function"!=typeof e)throw new Error("Illegal parameters.");if(void 0!==i._mapKTypeVListenerTokens){var n=i._mapKTypeVListenerTokens[t];if(void 0!==n){for(var a=-1,r=null,s=0;s<n.length;s++)if(r=n[s],r.listener===e){a=s;break}a!==-1&&(n.splice(a,1),delete r.listener,delete r.thisArg),n.length<1&&delete i._mapKTypeVListenerTokens[t]}}},removeEventListeners:function(t){var e=this;if(void 0!==e._mapKTypeVListenerTokens)if(void 0===t)for(var i in e._mapKTypeVListenerTokens)e._mapKTypeVListenerTokens.hasOwnProperty(i)&&e.removeEventListeners(i);else{var n=e._mapKTypeVListenerTokens[t];if(void 0===n)return;for(var a=0;a<n.length;a++){var r=n[a];delete r.listener,delete r.thisArg}delete e._mapKTypeVListenerTokens[t]}},hasEventListener:function(t,e){var i=this;if(!t)throw new Error("Illegal parameters.");if(void 0===i._mapKTypeVListenerTokens)return!1;var n=i._mapKTypeVListenerTokens[t];if(void 0===e)return void 0!==n;for(var a=0;a<n.length;a++){var r=n[a];if(r.listener===e)return!0}return!1},dispatchEvent:function(t){var e=this;if(!t||!t.type)throw new Error("Illegal parameter event: "+t);if(t instanceof Event){console.warn("It recommends to use Object instead of Event class.");var i={};for(var n in t)t[n]instanceof Function||(i[n]=t[n]);t=i}if(void 0!==e._mapKTypeVListenerTokens){var a=e._mapKTypeVListenerTokens[t.type];if(void 0!==a){var r=this._target||e;t.target=r;for(var s=0;s<a.length;s++){var o=a[s];o.listener.call(o.thisArg,t)}}}},on:function(t,e,i){this.addEventListener(t,e,i)},off:function(t){this.removeEventListeners(t)},fire:function(t){this.dispatchEvent(t)}},t.exports=i},function(t,e,i){function n(){Object.call(this),this._timerCompleteHandler=this._timerCompleteHandler.bind(this),this._timer=new a(a.REQUEST_ANIMATION_FRAME,1),this._timer.on("timerComplete",this._timerCompleteHandler,this)}var a=i(6);n.prototype={constructor:n,_initialized:!1,_timer:null,_invalidatePropertiesQueue:[],_invalidatePropertiesFlag:!1,_invalidateSizeQueue:[],_invalidateSizeFlag:!1,_invalidateDisplayListQueue:[],_invalidateDisplayListFlag:!1,_timerCompleteHandler:function(t){this._invalidatePropertiesFlag&&this._validateProperties(),this._invalidateSizeFlag&&this._validateSize(),this._invalidateDisplayListFlag&&this._validateDisplayList()},invalidateProperties:function(t){t&&"function"==typeof t.validateProperties&&(this._invalidatePropertiesQueue.push(t),this._invalidatePropertiesFlag=!0,this._timer.running()||this._timer.start())},invalidateSize:function(t){t&&"function"==typeof t.validateSize&&(this._invalidateSizeQueue.push(t),this._invalidateSizeFlag=!0,this._timer.running()||this._timer.start())},invalidateDisplayList:function(t){t&&"function"==typeof t.validateDisplayList&&(this._invalidateDisplayListQueue.push(t),this._invalidateDisplayListFlag=!0,this._timer.running()||this._timer.start())},validateClient:function(t){if(!t)throw new Error("Target is NULL.");"function"==typeof t.validateProperties&&t.validateProperties(),"function"==typeof t.validateSize&&t.validateSize(),"function"==typeof t.validateDisplayList&&t.validateDisplayList()},_validateProperties:function(){for(;this._invalidatePropertiesQueue.length>0;){var t=this._invalidatePropertiesQueue.pop();t.validateProperties()}this._invalidatePropertiesFlag=!1},_validateSize:function(){for(;this._invalidateSizeQueue.length>0;){var t=this._invalidateSizeQueue.pop();t.validateSize()}this._invalidateSizeFlag=!1},_validateDisplayList:function(){for(;this._invalidateDisplayListQueue.length>0;){var t=this._invalidateDisplayListQueue.pop();t.validateDisplayList()}this._invalidateDisplayListFlag=!1}};var r=new n;n.getInstance=function(){return r},t.exports=n},function(t,e,i){function n(t,e){r.call(this),this._run=this._run.bind(this),this._setIntervalHandler=this._setIntervalHandler.bind(this),this._requestAnimationFrameHandler=this._requestAnimationFrameHandler.bind(this),this.delay(t),this.repeatCount(e||0)}var a=i(2),r=i(4);n.REQUEST_ANIMATION_FRAME=-4132,n.prototype=a(r.prototype,{constructor:n,_delay:void 0,_repeatCount:0,_currentCount:0,_intervalId:void 0,_setIntervalHandler:function(){this._run()},_requestAnimationFrameFlag:!1,_requestAnimationFrameCount:0,_requestAnimationFrameHandler:function(){1==this._requestAnimationFrameCount&&this._run(),this._requestAnimationFrameCount<1&&this._requestAnimationFrameCount++,this._requestAnimationFrameFlag&&requestAnimationFrame(this._requestAnimationFrameHandler)},_run:function(){return 0!=this._repeatCount&&this._currentCount>=this._repeatCount?(this.stop(),void this.fire({type:"timerComplete"})):(this._currentCount++,void this.fire({type:"timer"}))},delay:function(t){if(0==arguments.length)return this._delay;if(this._delay!=t){if(isNaN(t)||!isFinite(t)||t<=0&&t!=n.REQUEST_ANIMATION_FRAME)throw new Error("Illegal delay value: "+t);return this._delay=t,this.running()&&(this.stop(),this.start()),this}},repeatCount:function(t){if(0==arguments.length)return this._repeatCount;if(this._repeatCount!=t){if(isNaN(t)||!isFinite(t)||t<0)throw new Error("Illegal repeat count value: "+t);return this._repeatCount=t,this}},currentCount:function(){return this._currentCount},running:function(){return"number"==typeof this._intervalId||this._requestAnimationFrameFlag},reset:function(){this.stop(),this._currentCount=0},start:function(){this.running()||(this._delay==n.REQUEST_ANIMATION_FRAME&&"function"==typeof requestAnimationFrame?(this._requestAnimationFrameFlag=!0,requestAnimationFrame(this._requestAnimationFrameHandler)):this._delay>0&&(this._intervalId=setInterval(this._setIntervalHandler,this._delay)))},stop:function(){this.running()&&(clearInterval(this._intervalId),this._intervalId=null,this._requestAnimationFrameFlag=!1,this._requestAnimationFrameCount=0)}}),t.exports=n},function(t,e,i){var n=(i(8),{toTreeData:function(t,e,i){i=i||{};var n=i.vertexIdField||"id",a=i.edgeSourceIdField||"source",r=i.edgeTargetIdField||"target",s=i.childrenField||"children",o="_vertexInfo_"+Math.round(4294967295*Math.random()),l={},h=[],d=[];if(e instanceof Array&&e.forEach(function(t){var e={id:t[n],visited:!1,inDegree:0,outDegree:0};t[o]=e,t[s]=[],l[e.id]=t,h.push(t)}),!(t instanceof Array))throw new Error("Edge data are required.");if(t.forEach(function(t){var e=t[a],i=l[e];if(!i){i={};var d={id:e,visited:!1,inDegree:0,outDegree:0};i[n]=e,i[o]=d,i[s]=[],l[d.id]=i,h.push(i)}var u=t[r],v=l[t.target];v||(v={},d={id:u,visited:!1,inDegree:0,outDegree:0},v[n]=u,v[o]=d,v[s]=[],l[d.id]=v,h.push(v)),i[o].outDegree++,v[o].inDegree++,i[s].push(v)}),h.forEach(function(t){var e=t[o];delete t[o],0==e.inDegree&&d.push(t)}),0==d.length)throw new Error("It's NOT a tree structure.");if(d.length>1){var u={};return u[n]="auto_root_"+Math.round(16777215*Math.random()),u[s]=d,u}return d[0]}});t.exports=n},function(e,i){e.exports=t},function(t,e,i){var n=(i(8),{toDataUrl:function(t,e,i){if(!t||"function"!=typeof e)throw new Error("Illegal parameters.");i||(i="image/png");var n=t.getAttribute("width"),a=t.getAttribute("height");t.setAttribute("version","1.1"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xlink","http://www.w3.org/1999/xlink");var r=(new XMLSerializer).serializeToString(t),s="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(r),o=document.createElement("canvas");o.width=n,o.height=a;var l=o.getContext("2d"),h=new Image;h.onload=function(){l.drawImage(h,0,0),"function"==typeof e&&e(o.toDataURL(i))},h.src=s},_toDataUrl2:function(t,e){var i=t.getAttribute("width"),n=t.getAttribute("height");t.setAttribute("version","1.1"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xlink","http://www.w3.org/1999/xlink");var a=(new XMLSerializer).serializeToString(t),r=self.URL||self.webkitURL||self,s=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),o=r.createObjectURL(s),l=document.createElement("canvas");l.width=i,l.height=n;var h=l.getContext("2d"),d=new Image;d.onload=function(){h.drawImage(d,0,0);var t=l.toDataURL("image/png");r.revokeObjectURL(t),"function"==typeof e&&e(t)},d.src=o}});t.exports=n},function(t,e,i){function n(t){var e=0,i=!1,n=0,r=0,s={x:0,y:0},o={x:0,y:0},l=a.zoom().on("start.internal",function(){}).on("end.internal",function(){i=!1,n=0,r=0}).on("zoom.internal",function(){var t=a.touches(this);if(t&&t.length>1){if(!i){i=!0;var l=t[0][0]-t[1][0],h=t[0][1]-t[1][1];n=Math.atan2(l,h),r=e}l=t[0][0]-t[1][0],h=t[0][1]-t[1][1];var d=n-Math.atan2(l,h);e=r+d,a.event.rotation=e,s.x=(t[0][0]+t[1][0])/2,s.y=(t[0][1]+t[1][1])/2}else a.event.rotation=e;i&&(a.event.transform.x=s.x,a.event.transform.y=s.y),a.event&&a.event.transform&&(o.x=a.event.transform.x,o.y=a.event.transform.y)});return l.translate=function(t,e,i){l.transform(t,function(){return this.__zoom.x=e,this.__zoom.y=i,this.__zoom})},t.call(l),l}var a=i(8);t.exports=n}])});